<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:AdRev.Domain.MobileSync.Models;assembly=AdRev.Domain"
             x:Class="AdRev.Mobile.FormsPage"
             Title="Formulaires"
             BackgroundColor="#F5F5F5">

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Synchroniser" IconImageSource="sync.png" Clicked="OnSyncClicked" />
    </ContentPage.ToolbarItems>

    <Grid RowDefinitions="Auto,*">
        <VerticalStackLayout Padding="15" BackgroundColor="#512BD4">
            <Label Text="Formulaires Disponibles" TextColor="White" FontSize="18" FontAttributes="Bold" />
            <Label Text="Sélectionnez un formulaire pour commencer la collecte" TextColor="#DFD8F7" FontSize="12" />
        </VerticalStackLayout>

        <RefreshView Grid.Row="1" Command="{Binding RefreshCommand}" IsRefreshing="{Binding IsRefreshing}">
            <CollectionView x:Name="FormsCollectionView" 
                            SelectionMode="Single" 
                            SelectionChanged="OnFormSelected"
                            Margin="10">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:MobileQuestionnaire">
                        <Border StrokeShape="RoundRectangle 10" StrokeThickness="0" BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}" Margin="0,5" Padding="15">
                            <Border.Shadow>
                                <Shadow Brush="{AppThemeBinding Light=Black, Dark=White}" Offset="2,2" Radius="5" Opacity="0.1"/>
                            </Border.Shadow>
                            <VerticalStackLayout Spacing="5">
                                <Label Text="{Binding Title}" FontSize="16" FontAttributes="Bold" TextColor="{AppThemeBinding Light=#333, Dark=White}" />
                                <Label Text="{Binding Description}" FontSize="12" TextColor="{AppThemeBinding Light=#666, Dark=#AAA}" LineBreakMode="TailTruncation" />
                                <Label Text="{Binding CreatedAt, StringFormat='Créé le {0:dd/MM/yyyy}'}" FontSize="10" TextColor="{AppThemeBinding Light=#999, Dark=#888}" />
                            </VerticalStackLayout>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
                <CollectionView.EmptyView>
                    <VerticalStackLayout VerticalOptions="Center" HorizontalOptions="Center" Spacing="10">
                        <Label Text="Aucun formulaire disponible" TextColor="Gray" HorizontalOptions="Center" />
                        <Button Text="Actualiser" Clicked="OnRefreshClicked" />
                        <Button Text="Générer Démo" Clicked="OnGenerateDemoClicked" BackgroundColor="Gray" />
                    </VerticalStackLayout>
                </CollectionView.EmptyView>
            </CollectionView>
        </RefreshView>
    </Grid>
</ContentPage>
