<Window x:Class="AdRev.Desktop.ProtocolWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:local="clr-namespace:AdRev.Desktop"
        Title="Éditeur de Protocole" Height="800" Width="1200"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None" ResizeMode="CanResize"
        Icon="pack://application:,,,/AdRev.Desktop;component/Assets/AppIcon.png"
        Background="{StaticResource CalmBackgroundBrush}">

    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="60" ResizeBorderThickness="8" CornerRadius="0" GlassFrameThickness="0"/>
    </WindowChrome.WindowChrome>

    <Window.Resources>
        <local:EnumDescriptionConverter x:Key="EnumDescriptionConverter"/>
        
        <Style TargetType="{x:Type TextBox}" BasedOn="{StaticResource MaterialDesignOutlinedTextBox}">
            <Setter Property="Margin" Value="0,8,0,8"/>
            <Setter Property="AcceptsReturn" Value="True"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
            <Setter Property="VerticalScrollBarVisibility" Value="Auto"/>
        </Style>

        <Style x:Key="SectionLabelStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Margin" Value="0,15,0,5"/>
            <Setter Property="Foreground" Value="{StaticResource CalmSubHeaderBrush}"/>
            <Setter Property="Opacity" Value="0.8"/>
        </Style>
        
        <Style x:Key="CalmCardStyle" TargetType="materialDesign:Card">
            <Setter Property="Padding" Value="24"/>
            <Setter Property="UniformCornerRadius" Value="12"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="materialDesign:ShadowAssist.ShadowDepth" Value="Depth1"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Title Bar -->
            <RowDefinition Height="Auto"/> <!-- Tool Bar -->
            <RowDefinition Height="*"/>    <!-- Content -->
            <RowDefinition Height="Auto"/> <!-- Footer Status -->
        </Grid.RowDefinitions>

        <!-- Title Bar -->
        <Border Grid.Row="0" Background="{StaticResource CalmHeaderBrush}" Height="65">
            <Grid Margin="20,0">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <materialDesign:PackIcon Kind="FileDocumentEdit" Width="24" Height="24" Foreground="White" Margin="0,0,12,0"/>
                    <StackPanel>
                        <TextBlock Text="Éditeur de Protocole de Recherche" Foreground="White" FontSize="18" FontWeight="Bold"/>
                        <TextBlock x:Name="ProjectTitleTextBlock" Text="Chargement..." Foreground="#AACCFF" FontSize="12"/>
                    </StackPanel>
                </StackPanel>

                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" WindowChrome.IsHitTestVisibleInChrome="True">
                    <StackPanel x:Name="SharingRolePanel" Orientation="Horizontal" Margin="0,0,20,0" VerticalAlignment="Center">
                         <TextBlock Text="Simuler :" Foreground="White" VerticalAlignment="Center" Margin="0,0,8,0"/>
                         <ComboBox x:Name="ActiveRoleComboBox" Width="150" Foreground="White" materialDesign:TextFieldAssist.UnderlineBrush="White" SelectionChanged="ActiveRoleAndAccess_SelectionChanged"/>
                         <ComboBox x:Name="ActiveAccessComboBox" Width="100" Foreground="White" Margin="8,0,0,0" materialDesign:TextFieldAssist.UnderlineBrush="White" SelectionChanged="ActiveRoleAndAccess_SelectionChanged"/>
                    </StackPanel>
                    
                    <Button Style="{StaticResource MaterialDesignIconButton}" Click="Minimize_Click" Foreground="White">
                        <materialDesign:PackIcon Kind="WindowMinimize"/>
                    </Button>
                    <Button Style="{StaticResource MaterialDesignIconButton}" Click="Close_Click" Foreground="White">
                        <materialDesign:PackIcon Kind="WindowClose"/>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Tool Bar -->
        <materialDesign:ColorZone Grid.Row="1" Mode="Standard" Padding="8" materialDesign:ShadowAssist.ShadowDepth="Depth2">
            <StackPanel Orientation="Horizontal">
                <Button x:Name="MenuFileSave" Content="ENREGISTRER" Style="{StaticResource MaterialDesignFlatMidPrimaryButton}" Click="CreateProtocol_Click" Margin="0,0,8,0">
                     <Button.ContentTemplate>
                         <DataTemplate>
                             <StackPanel Orientation="Horizontal">
                                 <materialDesign:PackIcon Kind="ContentSave" Margin="0,0,8,0"/>
                                 <TextBlock Text="ENREGISTRER"/>
                             </StackPanel>
                         </DataTemplate>
                     </Button.ContentTemplate>
                </Button>
                <Button x:Name="MenuFileExport" Content="EXPORTER WORD" Style="{StaticResource MaterialDesignFlatButton}" Click="ExportWord_Click" Margin="0,0,8,0">
                     <Button.ContentTemplate>
                         <DataTemplate>
                             <StackPanel Orientation="Horizontal">
                                 <materialDesign:PackIcon Kind="FileWord" Margin="0,0,8,0"/>
                                 <TextBlock Text="EXPORTER WORD"/>
                             </StackPanel>
                         </DataTemplate>
                     </Button.ContentTemplate>
                </Button>
                <Separator Style="{StaticResource MaterialDesignSeparator}" Margin="8,0"/>
                <Button x:Name="MenuDiscussion" Content="ASSISTANT IA" Style="{StaticResource MaterialDesignFlatButton}" Click="MenuDiscussion_Click">
                     <Button.ContentTemplate>
                         <DataTemplate>
                             <StackPanel Orientation="Horizontal">
                                 <materialDesign:PackIcon Kind="Robot" Margin="0,0,8,0"/>
                                 <TextBlock Text="ASSISTANT IA"/>
                             </StackPanel>
                         </DataTemplate>
                     </Button.ContentTemplate>
                </Button>
            </StackPanel>
        </materialDesign:ColorZone>

        <!-- Main Content -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="280"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Navigation -->
            <Border Grid.Column="0" Background="{StaticResource CalmAltBackgroundBrush}" BorderBrush="{StaticResource CalmBorderBrush}" BorderThickness="0,0,1,0">
                <ListBox x:Name="SideMenuListBox" SelectionChanged="SideMenu_SelectionChanged" Style="{StaticResource MaterialDesignNavigationPrimaryListBox}" Background="Transparent">
                    <ListBoxItem Content="1. Informations Générales" Tag="1"/>
                    <ListBoxItem Content="2. Introduction &amp; Contexte" Tag="2"/>
                    <ListBoxItem Content="3. Objectifs" Tag="3"/>
                    <ListBoxItem Content="4. Cadre Conceptuel" Tag="4"/>
                    <ListBoxItem Content="5. Design &amp; Cadre" Tag="5"/>
                    <ListBoxItem Content="6. Population" Tag="6"/>
                    <ListBoxItem Content="7. Échantillonnage" Tag="7"/>
                    <ListBoxItem Content="8. Collecte de données" Tag="8"/>
                    <ListBoxItem Content="9. Budget" Tag="9"/>
                    <ListBoxItem Content="10. Éthique" Tag="10"/>
                    <ListBoxItem Content="11. Analyse Statistique" Tag="11"/>
                    <ListBoxItem Content="12. Résultats Attendus" Tag="12"/>
                    <ListBoxItem Content="13. Conclusion" Tag="13"/>
                    <ListBoxItem Content="14. Références" Tag="14"/>
                    <ListBoxItem Content="15. Annexes" Tag="16"/>
                    <ListBoxItem Content="16. Historique / Logs" Tag="15"/>
                </ListBox>
            </Border>

            <!-- Content Area -->
            <Grid Grid.Column="1" Margin="20">
                
                <!-- Step 1: General Info -->
                <ScrollViewer x:Name="View_Step1" Visibility="Visible">
                    <StackPanel MaxWidth="900">
                        <materialDesign:Card Style="{StaticResource CalmCardStyle}">
                            <StackPanel>
                                <TextBlock Text="Informations Générales" Style="{StaticResource MaterialDesignHeadline5TextBlock}" Margin="0,0,0,16"/>
                                <TextBlock Text="Titre du protocole" Style="{StaticResource SectionLabelStyle}"/>
                                <TextBox x:Name="TitleTextBox" materialDesign:HintAssist.Hint="Entrez le titre complet"/>
                                
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Margin="0,0,8,0">
                                        <TextBlock Text="Domaine" Style="{StaticResource SectionLabelStyle}"/>
                                        <ComboBox x:Name="DomainComboBox"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="1" Margin="8,0,0,0">
                                        <TextBlock Text="Style de Référence" Style="{StaticResource SectionLabelStyle}"/>
                                        <ComboBox x:Name="RefStyleComboStep1"/>
                                    </StackPanel>
                                </Grid>

                                <TextBlock Text="Auteur Principal" Style="{StaticResource SectionLabelStyle}" Margin="0,20,0,8"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <ComboBox x:Name="AuthorTitleBox" Width="80" Margin="0,0,8,0" materialDesign:HintAssist.Hint="Titre">
                                        <ComboBoxItem Content="Dr"/>
                                        <ComboBoxItem Content="Pr"/>
                                        <ComboBoxItem Content="M."/>
                                        <ComboBoxItem Content="Mme"/>
                                    </ComboBox>
                                    <TextBox Grid.Column="1" x:Name="AuthorFirstNameBox" materialDesign:HintAssist.Hint="Prénom" Margin="8,0,8,0"/>
                                    <TextBox Grid.Column="2" x:Name="AuthorLastNameBox" materialDesign:HintAssist.Hint="Nom" Margin="8,0,0,0"/>
                                </Grid>
                                
                                <TextBox x:Name="AuthorInstitutionBox" materialDesign:HintAssist.Hint="Institution / Affiliation"/>
                                <TextBox x:Name="AuthorEmailBox" materialDesign:HintAssist.Hint="Email de contact"/>

                                <TextBlock Text="Co-Auteurs" Style="{StaticResource SectionLabelStyle}" Margin="0,20,0,8"/>
                                <Grid Margin="0,0,0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="1.5*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBox x:Name="CoAuthFirst" materialDesign:HintAssist.Hint="Prénom" Margin="0,0,8,0"/>
                                    <TextBox x:Name="CoAuthLast" Grid.Column="1" materialDesign:HintAssist.Hint="Nom" Margin="0,0,8,0"/>
                                    <TextBox x:Name="CoAuthInst" Grid.Column="2" materialDesign:HintAssist.Hint="Institution" Margin="0,0,8,0"/>
                                    <Button Grid.Column="3" Content="AJOUTER" Click="AddCoAuthor_Click"/>
                                </Grid>
                                <ListBox x:Name="CoAuthorsListBox" MinHeight="100" BorderThickness="1" BorderBrush="{DynamicResource MaterialDesignDivider}">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="{Binding}" VerticalAlignment="Center"/>
                                                <Button Grid.Column="1" Content="Supprimer" Style="{StaticResource MaterialDesignFlatButton}" Foreground="Red" Click="RemoveCoAuthor_Click" Tag="{Binding}"/>
                                            </Grid>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                            </StackPanel>
                        </materialDesign:Card>
                    </StackPanel>
                </ScrollViewer>

                <!-- Step 2: Introduction -->
                <ScrollViewer x:Name="View_Introduction" Visibility="Collapsed">
                    <StackPanel MaxWidth="900">
                        <materialDesign:Card Style="{StaticResource CalmCardStyle}">
                            <StackPanel>
                                <TextBlock Text="Introduction &amp; Contexte" Style="{StaticResource MaterialDesignHeadline5TextBlock}" Margin="0,0,0,16"/>
                                <TextBlock Text="Contexte" Style="{StaticResource SectionLabelStyle}"/>
                                <TextBox x:Name="ContextTextBox" MinHeight="200"/>
                                <TextBlock Text="Justification du problème" Style="{StaticResource SectionLabelStyle}"/>
                                <TextBox x:Name="ProblemTextBox" MinHeight="100"/>
                                <TextBlock Text="Question de recherche" Style="{StaticResource SectionLabelStyle}"/>
                                <TextBox x:Name="ResearchQuestionTextBox" MinHeight="60"/>
                                <TextBlock Text="Hypothèses" Style="{StaticResource SectionLabelStyle}"/>
                                <TextBox x:Name="HypothesesTextBox" MinHeight="60"/>
                            </StackPanel>
                        </materialDesign:Card>
                    </StackPanel>
                </ScrollViewer>

                <!-- Step 3: Objectives -->
                <ScrollViewer x:Name="View_Objectives" Visibility="Collapsed">
                    <StackPanel MaxWidth="900">
                        <materialDesign:Card Style="{StaticResource CalmCardStyle}">
                            <StackPanel>
                                <TextBlock Text="Objectifs de l'étude" Style="{StaticResource MaterialDesignHeadline5TextBlock}" Margin="0,0,0,16"/>
                                <TextBlock Text="Objectif Général" Style="{StaticResource SectionLabelStyle}"/>
                                <TextBox x:Name="GeneralObjectiveTextBox" MinHeight="100"/>
                                <TextBlock Text="Objectifs Spécifiques" Style="{StaticResource SectionLabelStyle}"/>
                                <TextBox x:Name="SpecificObjectivesTextBox" MinHeight="200"/>
                            </StackPanel>
                        </materialDesign:Card>
                    </StackPanel>
                </ScrollViewer>

                <!-- Step 4: Conceptual Framework -->
                <ScrollViewer x:Name="View_ConceptualFramework" Visibility="Collapsed">
                    <StackPanel MaxWidth="900">
                        <materialDesign:Card Style="{StaticResource CalmCardStyle}">
                            <StackPanel>
                                <TextBlock Text="Cadre Conceptuel" Style="{StaticResource MaterialDesignHeadline5TextBlock}" Margin="0,0,0,16"/>
                                <TextBlock Text="Définition des concepts" Style="{StaticResource SectionLabelStyle}"/>
                                <TextBox x:Name="ConceptsTextBox" MinHeight="150"/>
                                <TextBlock Text="Modèle conceptuel" Style="{StaticResource SectionLabelStyle}"/>
                                <TextBox x:Name="ConceptualModelTextBox" MinHeight="150"/>
                            </StackPanel>
                        </materialDesign:Card>
                    </StackPanel>
                </ScrollViewer>

                <!-- Step 5: Design & Setting -->
                <ScrollViewer x:Name="View_Methodology_Design" Visibility="Collapsed">
                    <StackPanel MaxWidth="900">
                        <materialDesign:Card Style="{StaticResource CalmCardStyle}">
                            <StackPanel>
                                <TextBlock Text="Design &amp; Cadre de l'étude" Style="{StaticResource MaterialDesignHeadline5TextBlock}" Margin="0,0,0,16"/>
                                <TextBlock Text="Type d'étude" Style="{StaticResource SectionLabelStyle}"/>
                                <ComboBox x:Name="StudyTypeComboBox" Margin="0,0,0,16" SelectionChanged="StudyTypeComboBox_SelectionChanged"/>
                                
                                <StackPanel x:Name="EpidemiologyTypePanel" Visibility="Collapsed">
                                    <TextBlock Text="Type épidémiologique" Style="{StaticResource SectionLabelStyle}"/>
                                    <ComboBox x:Name="EpidemiologyTypeComboBox" Margin="0,0,0,16"/>
                                </StackPanel>

                                <StackPanel x:Name="QualitativeTypePanel" Visibility="Collapsed">
                                    <TextBlock Text="Approche qualitative" Style="{StaticResource SectionLabelStyle}"/>
                                    <ComboBox x:Name="QualitativeApproachComboBox" Margin="0,0,0,16"/>
                                    <TextBlock Text="Échantillonnage qualitatif" Style="{StaticResource SectionLabelStyle}"/>
                                    <ComboBox x:Name="QualitativeSamplingComboBox" Margin="0,0,0,16"/>
                                </StackPanel>

                                <TextBlock Text="Cadre / Lieu de l'étude" Style="{StaticResource SectionLabelStyle}"/>
                                <TextBox x:Name="StudySettingTextBox" MinHeight="80"/>
                                
                                <CheckBox x:Name="IsMulticentricCheckBox" Content="Étude multicentrique" Margin="0,12,0,0" Checked="IsMulticentricCheckBox_Checked" Unchecked="IsMulticentricCheckBox_Unchecked"/>
                                <StackPanel x:Name="MulticentricDetailsPanel" Visibility="Collapsed">
                                    <TextBlock Text="Centres participants" Style="{StaticResource SectionLabelStyle}"/>
                                    <TextBox x:Name="StudyCentersTextBox" MinHeight="60"/>
                                </StackPanel>
                            </StackPanel>
                        </materialDesign:Card>
                    </StackPanel>
                </ScrollViewer>

                <!-- Step 6: Population -->
                <ScrollViewer x:Name="View_Methodology_Population" Visibility="Collapsed">
                    <StackPanel MaxWidth="900">
                        <materialDesign:Card Style="{StaticResource CalmCardStyle}">
                            <StackPanel>
                                <TextBlock Text="Population &amp; Critères" Style="{StaticResource MaterialDesignHeadline5TextBlock}" Margin="0,0,0,16"/>
                                <TextBlock Text="Population d'étude" Style="{StaticResource SectionLabelStyle}"/>
                                <TextBox x:Name="PopulationTextBox" MinHeight="80"/>
                                <TextBlock Text="Critères d'inclusion" Style="{StaticResource SectionLabelStyle}"/>
                                <TextBox x:Name="InclusionTextBox" MinHeight="100"/>
                                <TextBlock Text="Critères d'exclusion" Style="{StaticResource SectionLabelStyle}"/>
                                <TextBox x:Name="ExclusionTextBox" MinHeight="100"/>
                            </StackPanel>
                        </materialDesign:Card>
                    </StackPanel>
                </ScrollViewer>

                <!-- Step 7: Sampling -->
                <ScrollViewer x:Name="View_Methodology_Sampling" Visibility="Collapsed">
                    <StackPanel MaxWidth="900">
                        <materialDesign:Card Style="{StaticResource CalmCardStyle}">
                            <StackPanel>
                                <TextBlock Text="Échantillonnage" Style="{StaticResource MaterialDesignHeadline5TextBlock}" Margin="0,0,0,16"/>
                                <TextBlock Text="Type d'échantillonnage" Style="{StaticResource SectionLabelStyle}"/>
                                <ComboBox x:Name="SamplingTypeComboBox" Margin="0,0,0,16" SelectionChanged="SamplingTypeComboBox_SelectionChanged"/>

                                <StackPanel x:Name="StratificationPanel" Visibility="Collapsed">
                                    <CheckBox x:Name="IsStratifiedCheckBox" Content="Stratification" Checked="IsStratifiedCheckBox_Checked" Unchecked="IsStratifiedCheckBox_Unchecked"/>
                                    <TextBox x:Name="StratificationCriteriaTextBox" materialDesign:HintAssist.Hint="Critères de stratification" Visibility="Collapsed"/>
                                </StackPanel>

                                <StackPanel x:Name="ClusterPanel" Visibility="Collapsed">
                                    <CheckBox x:Name="IsClusterCheckBox" Content="Grappes" Checked="IsClusterCheckBox_Checked" Unchecked="IsClusterCheckBox_Unchecked"/>
                                    <TextBox x:Name="ClusterSizeTextBox" materialDesign:HintAssist.Hint="Taille des grappes"/>
                                    <TextBox x:Name="DesignEffectTextBox" materialDesign:HintAssist.Hint="Effet de plan"/>
                                </StackPanel>

                                <TextBlock Text="Taux de perdus de vue estimé (%)" Style="{StaticResource SectionLabelStyle}"/>
                                <TextBox x:Name="ExpectedLossRateTextBox" Width="100" HorizontalAlignment="Left"/>

                                <TextBlock Text="Méthode de calcul / Détails" Style="{StaticResource SectionLabelStyle}"/>
                                <TextBox x:Name="SamplingTextBox" MinHeight="100"/>
                                
                                <ComboBox x:Name="CalculatorSelector" Margin="0,12,0,0" materialDesign:HintAssist.Hint="Assistant de calcul" SelectionChanged="CalculatorSelector_SelectionChanged">
                                    <ComboBoxItem Content="Aucun"/>
                                    <ComboBoxItem Content="Cochran (Population infinie)"/>
                                </ComboBox>
                                <Border x:Name="PanelCochran" Visibility="Collapsed" Background="#F5F5F5" Padding="15" Margin="0,8" CornerRadius="4">
                                     <StackPanel>
                                         <TextBlock Text="Calculateur de Taille d'Échantillon (Cochran)" FontWeight="Bold" Margin="0,0,0,10"/>
                                         <TextBox materialDesign:HintAssist.Hint="Degré de confiance (Z=1.96 pour 95%)" Text="1.96"/>
                                         <TextBox materialDesign:HintAssist.Hint="Proportion attendue (p=0.5)" Text="0.5"/>
                                         <TextBox materialDesign:HintAssist.Hint="Marge d'erreur (e=0.05)" Text="0.05"/>
                                         <Button Content="CALCULER" Click="CalculateCochran_Click" Margin="0,10,0,0" HorizontalAlignment="Right"/>
                                     </StackPanel>
                                </Border>
                            </StackPanel>
                        </materialDesign:Card>
                    </StackPanel>
                </ScrollViewer>

                <!-- Step 8: Data Collection -->
                <ScrollViewer x:Name="View_Methodology_Data" Visibility="Collapsed">
                    <StackPanel MaxWidth="900">
                        <materialDesign:Card Style="{StaticResource CalmCardStyle}">
                            <StackPanel>
                                <TextBlock Text="Collecte de données" Style="{StaticResource MaterialDesignHeadline5TextBlock}" Margin="0,0,0,16"/>
                                <TextBlock Text="Méthodes et outils" Style="{StaticResource SectionLabelStyle}"/>
                                <TextBox x:Name="DataCollectionTextBox" MinHeight="250"/>
                            </StackPanel>
                        </materialDesign:Card>
                    </StackPanel>
                </ScrollViewer>

                <!-- Step 9: Budget -->
                <ScrollViewer x:Name="View_Budget" Visibility="Collapsed">
                    <StackPanel MaxWidth="900">
                        <materialDesign:Card Style="{StaticResource CalmCardStyle}">
                            <StackPanel>
                                <TextBlock Text="Budget &amp; Ressources" Style="{StaticResource MaterialDesignHeadline5TextBlock}" Margin="0,0,0,16"/>
                                <TextBox x:Name="BudgetTextBox" MinHeight="250"/>
                            </StackPanel>
                        </materialDesign:Card>
                    </StackPanel>
                </ScrollViewer>

                <!-- Step 10: Ethics -->
                <ScrollViewer x:Name="View_Ethics" Visibility="Collapsed">
                    <StackPanel MaxWidth="900">
                        <materialDesign:Card Style="{StaticResource CalmCardStyle}">
                            <StackPanel>
                                <TextBlock Text="Considérations Éthiques" Style="{StaticResource MaterialDesignHeadline5TextBlock}" Margin="0,0,0,16"/>
                                <TextBox x:Name="EthicsTextBox" MinHeight="250"/>
                            </StackPanel>
                        </materialDesign:Card>
                    </StackPanel>
                </ScrollViewer>

                <!-- Step 11: Data Analysis -->
                <ScrollViewer x:Name="View_DataAnalysis" Visibility="Collapsed">
                    <StackPanel MaxWidth="900">
                        <materialDesign:Card Style="{StaticResource CalmCardStyle}">
                            <StackPanel>
                                <TextBlock Text="Plan d'Analyse Statistique" Style="{StaticResource MaterialDesignHeadline5TextBlock}" Margin="0,0,0,16"/>
                                <TextBox x:Name="DataAnalysisTextBox" MinHeight="250"/>
                            </StackPanel>
                        </materialDesign:Card>
                    </StackPanel>
                </ScrollViewer>

                <!-- Step 12: Results -->
                <ScrollViewer x:Name="View_Results" Visibility="Collapsed">
                    <StackPanel MaxWidth="900">
                        <materialDesign:Card Style="{StaticResource CalmCardStyle}">
                            <StackPanel>
                                <TextBlock Text="Résultats Attendus" Style="{StaticResource MaterialDesignHeadline5TextBlock}" Margin="0,0,0,16"/>
                                <TextBox x:Name="ExpectedResultsTextBox" MinHeight="250"/>
                            </StackPanel>
                        </materialDesign:Card>
                    </StackPanel>
                </ScrollViewer>

                <!-- Step 13: Conclusion -->
                <ScrollViewer x:Name="View_Conclusion" Visibility="Collapsed">
                    <StackPanel MaxWidth="900">
                        <materialDesign:Card Style="{StaticResource CalmCardStyle}">
                            <StackPanel>
                                <TextBlock Text="Conclusion" Style="{StaticResource MaterialDesignHeadline5TextBlock}" Margin="0,0,0,16"/>
                                <TextBox x:Name="ConclusionTextBox" MinHeight="250"/>
                                <ComboBox x:Name="RefStyleComboStep13" materialDesign:HintAssist.Hint="Style Bibliographique"/>
                            </StackPanel>
                        </materialDesign:Card>
                    </StackPanel>
                </ScrollViewer>

                <!-- Step 14: References -->
                <ScrollViewer x:Name="View_References" Visibility="Collapsed">
                    <StackPanel MaxWidth="900">
                        <materialDesign:Card Style="{StaticResource CalmCardStyle}">
                            <StackPanel>
                                <TextBlock Text="Références" Style="{StaticResource MaterialDesignHeadline5TextBlock}" Margin="0,0,0,16"/>
                                <TextBox x:Name="ReferencesTextBox" MinHeight="400"/>
                            </StackPanel>
                        </materialDesign:Card>
                    </StackPanel>
                </ScrollViewer>

                <!-- Step 15: Appendices -->
                <ScrollViewer x:Name="View_Appendices" Visibility="Collapsed">
                    <StackPanel MaxWidth="900">
                        <materialDesign:Card Style="{StaticResource CalmCardStyle}">
                            <StackPanel>
                                <TextBlock Text="Annexes" Style="{StaticResource MaterialDesignHeadline5TextBlock}" Margin="0,0,0,16"/>
                                <ListBox x:Name="AppendicesListBox" MinHeight="100" BorderThickness="1" BorderBrush="{DynamicResource MaterialDesignDivider}">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="{Binding}" VerticalAlignment="Center"/>
                                                <Button Grid.Column="1" Content="Supprimer" Style="{StaticResource MaterialDesignFlatButton}" Foreground="Red" Click="RemoveAppendix_Click" Tag="{Binding}"/>
                                            </Grid>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                                <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                    <ComboBox x:Name="AppendixTypeComboBox" Width="200" materialDesign:HintAssist.Hint="Type d'annexe"/>
                                    <Button Content="AJOUTER ANNEXE" Margin="8,0,0,0" Click="AddAppendix_Click"/>
                                </StackPanel>
                            </StackPanel>
                        </materialDesign:Card>
                    </StackPanel>
                </ScrollViewer>

                <!-- Step 16: Audit Logs -->
                <ScrollViewer x:Name="View_AuditLogs" Visibility="Collapsed">
                    <StackPanel MaxWidth="900">
                        <materialDesign:Card Style="{StaticResource CalmCardStyle}">
                            <StackPanel>
                                <TextBlock Text="Historique des modifications (Logs)" Style="{StaticResource MaterialDesignHeadline5TextBlock}" Margin="0,0,0,16"/>
                                <ListBox x:Name="AuditLogsListBox" MinHeight="400"/>
                            </StackPanel>
                        </materialDesign:Card>
                    </StackPanel>
                </ScrollViewer>

            </Grid>
        </Grid>

        <!-- Footer -->
        <Border Grid.Row="3" Background="{DynamicResource MaterialDesignCardBackground}" Height="30" BorderBrush="{DynamicResource MaterialDesignDivider}" BorderThickness="0,1,0,0">
             <TextBlock x:Name="StatusInfo" Text="Prêt" Margin="10,0" VerticalAlignment="Center" FontSize="11" Opacity="0.7"/>
        </Border>
    </Grid>
</Window>
